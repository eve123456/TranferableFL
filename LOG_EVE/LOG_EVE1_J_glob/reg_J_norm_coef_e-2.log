nohup: ignoring input
working!
check why cannot sync
Using device: cuda:0
>>> Arguments:
	             algo : fedavgtl
	            alpha : 13.2316427
	       batch_size : 64
	clients_per_round : 100
	             clip : False
	          dataset : mnist_all_data_1_equal_niid
	           device : cuda:0
	              dis : 
	   early_stopping : 10
	       eval_every : 5
	    ft_batch_size : 128
	       ft_dataset : mnist-m
	        ft_epochs : 200
	            ft_lr : 0.001
	            ft_wd : 0.0001
	              gpu : True
	      input_shape : (1, 28, 28)
	           last_k : 1
	               lr : 0.01
	            model : lenet
	           n_init : 1
	        noaverage : False
	             noft : False
	          noprint : False
	        num_class : 10
	        num_epoch : 1
	        num_round : 200
	           opt_lr : False
	            reg_J : False
	       reg_J_coef : 0.0
	   reg_J_ind_coef : 0.0
	  reg_J_norm_coef : 0.01
	           repeat : 1
	     repeat_epoch : 10
	             seed : 0
	               wd : 0.0
>>> Read data from:
     ./data/mnist/data/all_data_1.pkl
>>> The estimate of constant alpha is 13.2316427.
>>> Read data from:
     ./data/mnist/data/train/all_data_1_equal_niid.pkl
     ./data/mnist/data/test/all_data_1_equal_niid.pkl

************************************************************************************************************************

uid: 20230926213751
FL pretrained model will be saved at ./models/lenet_mnist_20230926213751.pt
>>> Use gpu on device cuda:0
>>> Model statistic per layer
LeNet_MNIST(
  286.12 KMac, 100.000% MACs, 
  (conv1): Conv2d(89.856 KMac, 31.405% MACs, 1, 6, kernel_size=(5, 5), stride=(1, 1))
  (conv2): Conv2d(154.624 KMac, 54.042% MACs, 6, 16, kernel_size=(5, 5), stride=(1, 1))
  (fc1): Linear(30.72 KMac, 10.737% MACs, in_features=256, out_features=120, bias=True)
  (fc2): Linear(10.08 KMac, 3.523% MACs, in_features=120, out_features=84, bias=True)
  (fc3): Linear(840.0 Mac, 0.294% MACs, in_features=84, out_features=10, bias=True)
)
>>> Activate a worker for training
>>> Initialize 100 clients in total
>>> Weigh updates by simple average
>>> Select 100 clients per round 


>>> Round:    0 / Acc: 9.648% / Loss: 2.3062 /Time: 4.18s
======================================================================================================

= Test = round: 0 / acc: 8.600% / loss: 2.3073 / Time: 0.79s
======================================================================================================


>>> Round:    5 / Acc: 18.655% / Loss: 2.2755 /Time: 4.12s
======================================================================================================

= Test = round: 5 / acc: 17.760% / loss: 2.2781 / Time: 0.78s
======================================================================================================


>>> Round:   10 / Acc: 32.076% / Loss: 2.1918 /Time: 4.31s
======================================================================================================

= Test = round: 10 / acc: 32.690% / loss: 2.1912 / Time: 0.83s
======================================================================================================


>>> Round:   15 / Acc: 60.087% / Loss: 2.0928 /Time: 4.36s
======================================================================================================

= Test = round: 15 / acc: 61.550% / loss: 2.0882 / Time: 0.82s
======================================================================================================


>>> Round:   20 / Acc: 66.196% / Loss: 1.9287 /Time: 4.35s
======================================================================================================

= Test = round: 20 / acc: 67.500% / loss: 1.9187 / Time: 0.85s
======================================================================================================


>>> Round:   25 / Acc: 74.035% / Loss: 1.6743 /Time: 4.30s
======================================================================================================

= Test = round: 25 / acc: 75.200% / loss: 1.6552 / Time: 0.86s
======================================================================================================


>>> Round:   30 / Acc: 75.323% / Loss: 1.4017 /Time: 4.27s
======================================================================================================

= Test = round: 30 / acc: 76.860% / loss: 1.3729 / Time: 0.88s
======================================================================================================


>>> Round:   35 / Acc: 77.858% / Loss: 1.1654 /Time: 4.16s
======================================================================================================

= Test = round: 35 / acc: 79.320% / loss: 1.1296 / Time: 0.81s
======================================================================================================


>>> Round:   40 / Acc: 79.101% / Loss: 0.9926 /Time: 3.99s
======================================================================================================

= Test = round: 40 / acc: 80.770% / loss: 0.9533 / Time: 0.77s
======================================================================================================


>>> Round:   45 / Acc: 81.076% / Loss: 0.8630 /Time: 3.99s
======================================================================================================

= Test = round: 45 / acc: 82.450% / loss: 0.8235 / Time: 0.78s
======================================================================================================


>>> Round:   50 / Acc: 82.655% / Loss: 0.7627 /Time: 4.22s
======================================================================================================

= Test = round: 50 / acc: 83.920% / loss: 0.7227 / Time: 0.82s
======================================================================================================


>>> Round:   55 / Acc: 83.622% / Loss: 0.6887 /Time: 4.07s
======================================================================================================

= Test = round: 55 / acc: 84.870% / loss: 0.6509 / Time: 0.81s
======================================================================================================


>>> Round:   60 / Acc: 84.725% / Loss: 0.6284 /Time: 4.10s
======================================================================================================

= Test = round: 60 / acc: 86.100% / loss: 0.5914 / Time: 0.79s
======================================================================================================


>>> Round:   65 / Acc: 85.987% / Loss: 0.5733 /Time: 4.19s
======================================================================================================

= Test = round: 65 / acc: 87.240% / loss: 0.5379 / Time: 0.82s
======================================================================================================


>>> Round:   70 / Acc: 86.642% / Loss: 0.5334 /Time: 4.24s
======================================================================================================

= Test = round: 70 / acc: 87.790% / loss: 0.4989 / Time: 0.82s
======================================================================================================


>>> Round:   75 / Acc: 87.279% / Loss: 0.4981 /Time: 4.27s
======================================================================================================

= Test = round: 75 / acc: 88.360% / loss: 0.4645 / Time: 1.07s
======================================================================================================


>>> Round:   80 / Acc: 87.943% / Loss: 0.4687 /Time: 4.23s
======================================================================================================

= Test = round: 80 / acc: 88.980% / loss: 0.4361 / Time: 0.82s
======================================================================================================


>>> Round:   85 / Acc: 88.450% / Loss: 0.4418 /Time: 4.22s
======================================================================================================

= Test = round: 85 / acc: 89.560% / loss: 0.4103 / Time: 0.80s
======================================================================================================


>>> Round:   90 / Acc: 88.507% / Loss: 0.4273 /Time: 4.09s
======================================================================================================

= Test = round: 90 / acc: 89.710% / loss: 0.3968 / Time: 0.79s
======================================================================================================


>>> Round:   95 / Acc: 89.367% / Loss: 0.4011 /Time: 4.21s
======================================================================================================

= Test = round: 95 / acc: 90.550% / loss: 0.3710 / Time: 0.80s
======================================================================================================


>>> Round:  100 / Acc: 89.697% / Loss: 0.3860 /Time: 4.12s
======================================================================================================

= Test = round: 100 / acc: 90.890% / loss: 0.3558 / Time: 0.78s
======================================================================================================


>>> Round:  105 / Acc: 90.011% / Loss: 0.3674 /Time: 4.41s
======================================================================================================

= Test = round: 105 / acc: 91.240% / loss: 0.3378 / Time: 0.88s
======================================================================================================


>>> Round:  110 / Acc: 90.358% / Loss: 0.3549 /Time: 4.05s
======================================================================================================

= Test = round: 110 / acc: 91.630% / loss: 0.3255 / Time: 0.80s
======================================================================================================


>>> Round:  115 / Acc: 90.653% / Loss: 0.3399 /Time: 4.42s
======================================================================================================

= Test = round: 115 / acc: 91.880% / loss: 0.3111 / Time: 0.85s
======================================================================================================


>>> Round:  120 / Acc: 90.895% / Loss: 0.3295 /Time: 4.07s
======================================================================================================

= Test = round: 120 / acc: 92.100% / loss: 0.3009 / Time: 0.81s
======================================================================================================


>>> Round:  125 / Acc: 91.173% / Loss: 0.3203 /Time: 4.01s
======================================================================================================

= Test = round: 125 / acc: 92.270% / loss: 0.2925 / Time: 0.78s
======================================================================================================


>>> Round:  130 / Acc: 91.406% / Loss: 0.3088 /Time: 4.06s
======================================================================================================

= Test = round: 130 / acc: 92.520% / loss: 0.2813 / Time: 0.78s
======================================================================================================


>>> Round:  135 / Acc: 91.625% / Loss: 0.3007 /Time: 4.00s
======================================================================================================

= Test = round: 135 / acc: 92.710% / loss: 0.2734 / Time: 0.79s
======================================================================================================


>>> Round:  140 / Acc: 91.825% / Loss: 0.2927 /Time: 4.08s
======================================================================================================

= Test = round: 140 / acc: 92.910% / loss: 0.2659 / Time: 0.78s
======================================================================================================


>>> Round:  145 / Acc: 92.007% / Loss: 0.2850 /Time: 4.07s
======================================================================================================

= Test = round: 145 / acc: 93.010% / loss: 0.2581 / Time: 0.78s
======================================================================================================


>>> Round:  150 / Acc: 92.205% / Loss: 0.2757 /Time: 4.01s
======================================================================================================

= Test = round: 150 / acc: 93.140% / loss: 0.2493 / Time: 0.78s
======================================================================================================


>>> Round:  155 / Acc: 92.415% / Loss: 0.2661 /Time: 4.02s
======================================================================================================

= Test = round: 155 / acc: 93.300% / loss: 0.2402 / Time: 0.77s
======================================================================================================


>>> Round:  160 / Acc: 92.533% / Loss: 0.2593 /Time: 4.33s
======================================================================================================

= Test = round: 160 / acc: 93.470% / loss: 0.2336 / Time: 0.79s
======================================================================================================


>>> Round:  165 / Acc: 92.686% / Loss: 0.2535 /Time: 4.45s
======================================================================================================

= Test = round: 165 / acc: 93.540% / loss: 0.2283 / Time: 0.86s
======================================================================================================


>>> Round:  170 / Acc: 92.860% / Loss: 0.2501 /Time: 4.34s
======================================================================================================

= Test = round: 170 / acc: 93.730% / loss: 0.2250 / Time: 0.81s
======================================================================================================


>>> Round:  175 / Acc: 93.006% / Loss: 0.2422 /Time: 4.37s
======================================================================================================

= Test = round: 175 / acc: 93.880% / loss: 0.2176 / Time: 0.78s
======================================================================================================


>>> Round:  180 / Acc: 93.146% / Loss: 0.2369 /Time: 4.25s
======================================================================================================

= Test = round: 180 / acc: 93.950% / loss: 0.2128 / Time: 0.84s
======================================================================================================


>>> Round:  185 / Acc: 93.268% / Loss: 0.2317 /Time: 4.09s
======================================================================================================

= Test = round: 185 / acc: 94.020% / loss: 0.2078 / Time: 0.78s
======================================================================================================


>>> Round:  190 / Acc: 93.399% / Loss: 0.2272 /Time: 4.17s
======================================================================================================

= Test = round: 190 / acc: 94.120% / loss: 0.2036 / Time: 0.81s
======================================================================================================


>>> Round:  195 / Acc: 93.533% / Loss: 0.2222 /Time: 4.22s
======================================================================================================

= Test = round: 195 / acc: 94.220% / loss: 0.1986 / Time: 0.82s
======================================================================================================


>>> Round:  200 / Acc: 93.648% / Loss: 0.2180 /Time: 4.20s
======================================================================================================

= Test = round: 200 / acc: 94.340% / loss: 0.1949 / Time: 0.82s
======================================================================================================

>>> Training model_ft
Epoch: 001, Train_loss: 1.0129, Train_acc: 0.6948, Test_loss: 0.9971, Test_acc: 0.6967
Epoch: 006, Train_loss: 0.8217, Train_acc: 0.7490, Test_loss: 0.8246, Test_acc: 0.7486
Epoch: 011, Train_loss: 0.7641, Train_acc: 0.7630, Test_loss: 0.7822, Test_acc: 0.7561
Epoch: 016, Train_loss: 0.7469, Train_acc: 0.7653, Test_loss: 0.7765, Test_acc: 0.7567
Epoch: 021, Train_loss: 0.7067, Train_acc: 0.7742, Test_loss: 0.7473, Test_acc: 0.7625
Epoch: 026, Train_loss: 0.6838, Train_acc: 0.7821, Test_loss: 0.7376, Test_acc: 0.7665
Epoch: 031, Train_loss: 0.6763, Train_acc: 0.7830, Test_loss: 0.7333, Test_acc: 0.7665
Epoch: 036, Train_loss: 0.6571, Train_acc: 0.7885, Test_loss: 0.7282, Test_acc: 0.7688
Epoch: 041, Train_loss: 0.6444, Train_acc: 0.7924, Test_loss: 0.7200, Test_acc: 0.7702
Epoch: 046, Train_loss: 0.6374, Train_acc: 0.7939, Test_loss: 0.7274, Test_acc: 0.7714
Epoch: 051, Train_loss: 0.6356, Train_acc: 0.7944, Test_loss: 0.7312, Test_acc: 0.7667
Epoch: 056, Train_loss: 0.6311, Train_acc: 0.7947, Test_loss: 0.7279, Test_acc: 0.7729
Epoch: 061, Train_loss: 0.6168, Train_acc: 0.8002, Test_loss: 0.7232, Test_acc: 0.7720
Epoch: 066, Train_loss: 0.6099, Train_acc: 0.8025, Test_loss: 0.7207, Test_acc: 0.7715
Epoch: 071, Train_loss: 0.6020, Train_acc: 0.8038, Test_loss: 0.7192, Test_acc: 0.7742
Epoch: 076, Train_loss: 0.6048, Train_acc: 0.8033, Test_loss: 0.7245, Test_acc: 0.7704
Epoch: 081, Train_loss: 0.5990, Train_acc: 0.8049, Test_loss: 0.7197, Test_acc: 0.7719
Epoch: 086, Train_loss: 0.5948, Train_acc: 0.8076, Test_loss: 0.7187, Test_acc: 0.7717
Epoch: 091, Train_loss: 0.5910, Train_acc: 0.8061, Test_loss: 0.7174, Test_acc: 0.7724
Epoch: 096, Train_loss: 0.5911, Train_acc: 0.8072, Test_loss: 0.7216, Test_acc: 0.7730
Epoch: 101, Train_loss: 0.5906, Train_acc: 0.8069, Test_loss: 0.7244, Test_acc: 0.7718
Epoch: 106, Train_loss: 0.5830, Train_acc: 0.8093, Test_loss: 0.7127, Test_acc: 0.7755
Epoch: 111, Train_loss: 0.5831, Train_acc: 0.8088, Test_loss: 0.7189, Test_acc: 0.7720
Epoch: 116, Train_loss: 0.5744, Train_acc: 0.8125, Test_loss: 0.7180, Test_acc: 0.7722
Fine-tuning early stopped. Model saved at ./models/ft_checkpoints/20230926213751_model_ft.pt.
Model saved at ./models/ft_checkpoints/20230926213751_model_ft.pt.
>>> Fine-tuning done!
>>> Evaluating model_source_only
model_ft: [0.5739073629825875, 0.8131048626294469, 0.7150046290549791, 0.7746917009221198]
model_source_only: [1.769430344061246, 0.47639870510669313, 1.7780916304896108, 0.475391623152983]
fl_test_acc_mean 0.943
model_source_only_test_acc_mean 0.475391623152983
model_ft_test_acc_mean 0.7746917009221198
