nohup: ignoring input
working!
check why cannot sync
Using device: cuda:0
>>> Arguments:
	             algo : fedavgtl
	            alpha : 13.2316427
	       batch_size : 64
	clients_per_round : 100
	             clip : False
	          dataset : mnist_all_data_1_equal_niid
	           device : cuda:0
	              dis : 
	   early_stopping : 10
	       eval_every : 5
	    ft_batch_size : 128
	       ft_dataset : mnist-m
	        ft_epochs : 200
	            ft_lr : 0.001
	            ft_wd : 0.0001
	              gpu : True
	      input_shape : (1, 28, 28)
	           last_k : 1
	               lr : 0.01
	            model : lenet
	           n_init : 1
	        noaverage : False
	             noft : False
	          noprint : False
	        num_class : 10
	        num_epoch : 1
	        num_round : 200
	           opt_lr : False
	            reg_J : False
	       reg_J_coef : 0.0
	   reg_J_ind_coef : 0.0
	  reg_J_norm_coef : 0.01
	           repeat : 1
	     repeat_epoch : 10
	             seed : 0
	               wd : 0.0
>>> Read data from:
     ./data/mnist/data/all_data_1.pkl
nohup: ignoring input
working!
check why cannot sync
Using device: cuda:0
>>> Arguments:
	             algo : fedavgtl
	            alpha : 13.2316427
	       batch_size : 64
	clients_per_round : 100
	             clip : False
	          dataset : mnist_all_data_1_equal_niid
	           device : cuda:0
	              dis : 
	   early_stopping : 10
	       eval_every : 5
	    ft_batch_size : 128
	       ft_dataset : mnist-m
	        ft_epochs : 200
	            ft_lr : 0.001
	            ft_wd : 0.0001
	              gpu : True
	      input_shape : (1, 28, 28)
	           last_k : 1
	               lr : 0.01
	            model : lenet
	           n_init : 1
	        noaverage : False
	             noft : False
	          noprint : False
	        num_class : 10
	        num_epoch : 1
	        num_round : 200
	           opt_lr : False
	            reg_J : True
	       reg_J_coef : 0.01
	   reg_J_ind_coef : 0.0
	  reg_J_norm_coef : 0.0
	           repeat : 1
	     repeat_epoch : 10
	             seed : 0
	               wd : 0.0
>>> Read data from:
     ./data/mnist/data/all_data_1.pkl
>>> The estimate of constant alpha is 13.2316427.
>>> Read data from:
     ./data/mnist/data/train/all_data_1_equal_niid.pkl
     ./data/mnist/data/test/all_data_1_equal_niid.pkl

************************************************************************************************************************

uid: 20230926213830
FL pretrained model will be saved at ./models/lenet_mnist_20230926213830.pt
>>> Use gpu on device cuda:0
>>> Model statistic per layer
LeNet_MNIST(
  286.12 KMac, 100.000% MACs, 
  (conv1): Conv2d(89.856 KMac, 31.405% MACs, 1, 6, kernel_size=(5, 5), stride=(1, 1))
  (conv2): Conv2d(154.624 KMac, 54.042% MACs, 6, 16, kernel_size=(5, 5), stride=(1, 1))
  (fc1): Linear(30.72 KMac, 10.737% MACs, in_features=256, out_features=120, bias=True)
  (fc2): Linear(10.08 KMac, 3.523% MACs, in_features=120, out_features=84, bias=True)
  (fc3): Linear(840.0 Mac, 0.294% MACs, in_features=84, out_features=10, bias=True)
)
>>> Activate a worker for training
>>> Initialize 100 clients in total
>>> Weigh updates by simple average
>>> Select 100 clients per round 


>>> Round:    0 / Acc: 9.266% / Loss: 2.3040 /Time: 4.16s
======================================================================================================

= Test = round: 0 / acc: 9.070% / loss: 2.3055 / Time: 0.80s
======================================================================================================


>>> Round:    5 / Acc: 10.509% / Loss: 2.2834 /Time: 4.44s
======================================================================================================

= Test = round: 5 / acc: 10.610% / loss: 2.2849 / Time: 0.83s
======================================================================================================


>>> Round:   10 / Acc: 38.306% / Loss: 2.1406 /Time: 4.44s
======================================================================================================

= Test = round: 10 / acc: 37.690% / loss: 2.1345 / Time: 0.87s
======================================================================================================


>>> Round:   15 / Acc: 56.428% / Loss: 1.9309 /Time: 4.30s
======================================================================================================

= Test = round: 15 / acc: 57.830% / loss: 1.9137 / Time: 0.83s
======================================================================================================


>>> Round:   20 / Acc: 64.720% / Loss: 1.6416 /Time: 4.17s
======================================================================================================

= Test = round: 20 / acc: 66.990% / loss: 1.6124 / Time: 0.82s
======================================================================================================


>>> Round:   25 / Acc: 68.801% / Loss: 1.3540 /Time: 4.40s
======================================================================================================

= Test = round: 25 / acc: 71.120% / loss: 1.3170 / Time: 0.82s
======================================================================================================


>>> Round:   30 / Acc: 72.223% / Loss: 1.1182 /Time: 4.46s
======================================================================================================

= Test = round: 30 / acc: 73.940% / loss: 1.0796 / Time: 0.82s
======================================================================================================


>>> Round:   35 / Acc: 74.753% / Loss: 0.9514 /Time: 4.31s
======================================================================================================

= Test = round: 35 / acc: 76.390% / loss: 0.9142 / Time: 0.79s
======================================================================================================


>>> Round:   40 / Acc: 76.559% / Loss: 0.8383 /Time: 4.22s
======================================================================================================

= Test = round: 40 / acc: 78.200% / loss: 0.8032 / Time: 0.79s
======================================================================================================


>>> Round:   45 / Acc: 78.188% / Loss: 0.7544 /Time: 4.25s
======================================================================================================

= Test = round: 45 / acc: 79.810% / loss: 0.7204 / Time: 0.79s
======================================================================================================


>>> Round:   50 / Acc: 79.677% / Loss: 0.7013 /Time: 4.22s
======================================================================================================

= Test = round: 50 / acc: 80.980% / loss: 0.6678 / Time: 0.80s
======================================================================================================


>>> Round:   55 / Acc: 80.699% / Loss: 0.6571 /Time: 4.28s
======================================================================================================

= Test = round: 55 / acc: 82.210% / loss: 0.6246 / Time: 0.81s
======================================================================================================


>>> Round:   60 / Acc: 81.627% / Loss: 0.6223 /Time: 4.26s
======================================================================================================

= Test = round: 60 / acc: 83.140% / loss: 0.5905 / Time: 0.83s
======================================================================================================


>>> Round:   65 / Acc: 82.255% / Loss: 0.5924 /Time: 4.25s
======================================================================================================

= Test = round: 65 / acc: 83.850% / loss: 0.5602 / Time: 0.83s
======================================================================================================


>>> Round:   70 / Acc: 82.959% / Loss: 0.5680 /Time: 4.27s
======================================================================================================

= Test = round: 70 / acc: 84.420% / loss: 0.5371 / Time: 0.83s
======================================================================================================


>>> Round:   75 / Acc: 83.552% / Loss: 0.5465 /Time: 4.31s
======================================================================================================

= Test = round: 75 / acc: 84.950% / loss: 0.5156 / Time: 0.87s
======================================================================================================


>>> Round:   80 / Acc: 84.238% / Loss: 0.5242 /Time: 4.25s
======================================================================================================

= Test = round: 80 / acc: 85.470% / loss: 0.4925 / Time: 0.84s
======================================================================================================


>>> Round:   85 / Acc: 84.762% / Loss: 0.5075 /Time: 4.35s
======================================================================================================

= Test = round: 85 / acc: 85.970% / loss: 0.4766 / Time: 0.84s
======================================================================================================


>>> Round:   90 / Acc: 85.199% / Loss: 0.4908 /Time: 4.42s
======================================================================================================

= Test = round: 90 / acc: 86.460% / loss: 0.4598 / Time: 0.85s
======================================================================================================


>>> Round:   95 / Acc: 85.725% / Loss: 0.4765 /Time: 4.39s
======================================================================================================

= Test = round: 95 / acc: 86.820% / loss: 0.4458 / Time: 0.85s
======================================================================================================


>>> Round:  100 / Acc: 86.077% / Loss: 0.4626 /Time: 4.17s
======================================================================================================

= Test = round: 100 / acc: 87.290% / loss: 0.4306 / Time: 0.81s
======================================================================================================


>>> Round:  105 / Acc: 86.397% / Loss: 0.4512 /Time: 4.32s
======================================================================================================

= Test = round: 105 / acc: 87.610% / loss: 0.4211 / Time: 0.87s
======================================================================================================


>>> Round:  110 / Acc: 86.902% / Loss: 0.4379 /Time: 4.14s
======================================================================================================

= Test = round: 110 / acc: 88.080% / loss: 0.4073 / Time: 0.86s
======================================================================================================


>>> Round:  115 / Acc: 87.149% / Loss: 0.4269 /Time: 4.31s
======================================================================================================

= Test = round: 115 / acc: 88.340% / loss: 0.3969 / Time: 0.83s
======================================================================================================


>>> Round:  120 / Acc: 87.507% / Loss: 0.4168 /Time: 4.21s
======================================================================================================

= Test = round: 120 / acc: 88.680% / loss: 0.3871 / Time: 0.80s
======================================================================================================


>>> Round:  125 / Acc: 87.865% / Loss: 0.4064 /Time: 4.12s
======================================================================================================

= Test = round: 125 / acc: 88.920% / loss: 0.3770 / Time: 0.80s
======================================================================================================


>>> Round:  130 / Acc: 88.170% / Loss: 0.3971 /Time: 4.18s
======================================================================================================

= Test = round: 130 / acc: 89.200% / loss: 0.3683 / Time: 0.80s
======================================================================================================


>>> Round:  135 / Acc: 88.432% / Loss: 0.3885 /Time: 4.13s
======================================================================================================

= Test = round: 135 / acc: 89.500% / loss: 0.3600 / Time: 0.79s
======================================================================================================


>>> Round:  140 / Acc: 88.690% / Loss: 0.3800 /Time: 4.20s
======================================================================================================

= Test = round: 140 / acc: 89.690% / loss: 0.3525 / Time: 0.79s
======================================================================================================


>>> Round:  145 / Acc: 88.911% / Loss: 0.3718 /Time: 4.18s
======================================================================================================

= Test = round: 145 / acc: 90.040% / loss: 0.3446 / Time: 0.80s
======================================================================================================


>>> Round:  150 / Acc: 89.144% / Loss: 0.3642 /Time: 4.08s
======================================================================================================

= Test = round: 150 / acc: 90.170% / loss: 0.3374 / Time: 0.80s
======================================================================================================


>>> Round:  155 / Acc: 89.336% / Loss: 0.3565 /Time: 4.46s
======================================================================================================

= Test = round: 155 / acc: 90.470% / loss: 0.3306 / Time: 0.85s
======================================================================================================


>>> Round:  160 / Acc: 89.598% / Loss: 0.3487 /Time: 4.20s
======================================================================================================

= Test = round: 160 / acc: 90.510% / loss: 0.3229 / Time: 0.81s
======================================================================================================


>>> Round:  165 / Acc: 89.817% / Loss: 0.3421 /Time: 4.09s
======================================================================================================

= Test = round: 165 / acc: 90.850% / loss: 0.3164 / Time: 0.78s
======================================================================================================


>>> Round:  170 / Acc: 90.009% / Loss: 0.3356 /Time: 4.12s
======================================================================================================

= Test = round: 170 / acc: 91.020% / loss: 0.3104 / Time: 0.79s
======================================================================================================


>>> Round:  175 / Acc: 90.203% / Loss: 0.3285 /Time: 4.25s
======================================================================================================

= Test = round: 175 / acc: 91.080% / loss: 0.3037 / Time: 0.84s
======================================================================================================


>>> Round:  180 / Acc: 90.380% / Loss: 0.3231 /Time: 4.71s
======================================================================================================

= Test = round: 180 / acc: 91.210% / loss: 0.2989 / Time: 0.82s
======================================================================================================


>>> Round:  185 / Acc: 90.515% / Loss: 0.3170 /Time: 4.17s
======================================================================================================

= Test = round: 185 / acc: 91.250% / loss: 0.2934 / Time: 0.80s
======================================================================================================


>>> Round:  190 / Acc: 90.714% / Loss: 0.3121 /Time: 4.26s
======================================================================================================

= Test = round: 190 / acc: 91.410% / loss: 0.2887 / Time: 0.85s
======================================================================================================


>>> Round:  195 / Acc: 90.828% / Loss: 0.3065 /Time: 4.16s
======================================================================================================

= Test = round: 195 / acc: 91.570% / loss: 0.2839 / Time: 0.83s
======================================================================================================


>>> Round:  200 / Acc: 90.948% / Loss: 0.3014 /Time: 4.96s
======================================================================================================

= Test = round: 200 / acc: 91.650% / loss: 0.2788 / Time: 0.93s
======================================================================================================

>>> Training model_ft
Epoch: 001, Train_loss: 1.2180, Train_acc: 0.6178, Test_loss: 1.1915, Test_acc: 0.6294
Epoch: 006, Train_loss: 0.9397, Train_acc: 0.7048, Test_loss: 0.9359, Test_acc: 0.7073
Epoch: 011, Train_loss: 0.8712, Train_acc: 0.7247, Test_loss: 0.8858, Test_acc: 0.7258
Epoch: 016, Train_loss: 0.8565, Train_acc: 0.7268, Test_loss: 0.8846, Test_acc: 0.7264
Epoch: 021, Train_loss: 0.8163, Train_acc: 0.7386, Test_loss: 0.8595, Test_acc: 0.7333
Epoch: 026, Train_loss: 0.8052, Train_acc: 0.7418, Test_loss: 0.8568, Test_acc: 0.7336
Epoch: 031, Train_loss: 0.7789, Train_acc: 0.7502, Test_loss: 0.8380, Test_acc: 0.7405
Epoch: 036, Train_loss: 0.7849, Train_acc: 0.7459, Test_loss: 0.8564, Test_acc: 0.7317
Epoch: 041, Train_loss: 0.7550, Train_acc: 0.7575, Test_loss: 0.8271, Test_acc: 0.7434
Epoch: 046, Train_loss: 0.7604, Train_acc: 0.7547, Test_loss: 0.8394, Test_acc: 0.7383
Epoch: 051, Train_loss: 0.7560, Train_acc: 0.7547, Test_loss: 0.8423, Test_acc: 0.7378
Epoch: 056, Train_loss: 0.7478, Train_acc: 0.7582, Test_loss: 0.8355, Test_acc: 0.7353
Epoch: 061, Train_loss: 0.7291, Train_acc: 0.7638, Test_loss: 0.8247, Test_acc: 0.7404
Epoch: 066, Train_loss: 0.7271, Train_acc: 0.7652, Test_loss: 0.8247, Test_acc: 0.7437
Epoch: 071, Train_loss: 0.7131, Train_acc: 0.7685, Test_loss: 0.8126, Test_acc: 0.7496
Epoch: 076, Train_loss: 0.7224, Train_acc: 0.7645, Test_loss: 0.8241, Test_acc: 0.7437
Epoch: 081, Train_loss: 0.7038, Train_acc: 0.7719, Test_loss: 0.8077, Test_acc: 0.7480
Epoch: 086, Train_loss: 0.7053, Train_acc: 0.7734, Test_loss: 0.8093, Test_acc: 0.7468
Epoch: 091, Train_loss: 0.7019, Train_acc: 0.7731, Test_loss: 0.8182, Test_acc: 0.7460
Epoch: 096, Train_loss: 0.7021, Train_acc: 0.7738, Test_loss: 0.8184, Test_acc: 0.7446
Epoch: 101, Train_loss: 0.6895, Train_acc: 0.7772, Test_loss: 0.8083, Test_acc: 0.7494
Epoch: 106, Train_loss: 0.7024, Train_acc: 0.7715, Test_loss: 0.8250, Test_acc: 0.7431
Epoch: 111, Train_loss: 0.6997, Train_acc: 0.7731, Test_loss: 0.8157, Test_acc: 0.7440
Fine-tuning early stopped. Model saved at ./models/ft_checkpoints/20230926213830_model_ft.pt.
Model saved at ./models/ft_checkpoints/20230926213830_model_ft.pt.
>>> Fine-tuning done!
>>> Evaluating model_source_only
model_ft: [0.6879538526460439, 0.7774783478246131, 0.8110651667416593, 0.7433618486834797]
model_source_only: [2.4897252466413495, 0.4183149438145116, 2.5277346694301253, 0.41439840017775803]
fl_test_acc_mean 0.9159
model_source_only_test_acc_mean 0.41439840017775803
model_ft_test_acc_mean 0.7433618486834797
